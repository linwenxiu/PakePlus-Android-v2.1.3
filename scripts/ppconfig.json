{"name":"dacfabbeab","url":"https://account.fuhaogou.com","showName":"门店助手","appid":"youtuan.app","icon":"","iconPath":"","iconRound":true,"state":true,"single":true,"injectJq":true,"tauriApi":false,"devbug":true,"version":"1.0.1","preview":"desktop","platform":["1-1"],"width":800,"height":600,"desc":"","jsFile":[],"filterCss":"","customJs":"// 全局配置：目标域名、页面路径及对应CSS映射（保留原链接，优化加载逻辑）\nconst TARGET_DOMAIN = 'fuhaogou.com';\nconst LOGIN_PAGE_PATH = '/account#/login';\nconst PAGE_CSS_MAP = {\n    login: 'https://server.kexuny.cn/work/midd.css',\n    chooseStore: 'https://server.kexuny.cn/work/mdxz.css',\n    shop: 'https://server.kexuny.cn/work/shop.css'\n};\n\n// 1. 域名校验（保持不变）\nfunction isTargetDomain() {\n    const currentDomain = window.location.hostname;\n    const isMatch = currentDomain.includes(TARGET_DOMAIN);\n    if (!isMatch) {\n        console.log(`当前域名${currentDomain}非目标域名，停止执行脚本`);\n    }\n    return isMatch;\n}\n\n// 2. 页面类型判断（保持不变）\nfunction getCurrentPageType() {\n    const pathname = window.location.pathname;\n    const hash = window.location.hash;\n    const currentFullPath = pathname + hash;\n    \n    if (window.lastPageFullPath!== currentFullPath) {\n        console.log(`当前页面完整路径：${currentFullPath}`);\n        window.lastPageFullPath = currentFullPath;\n    }\n    \n    if (currentFullPath === LOGIN_PAGE_PATH) {\n        return 'login';\n    } else if (currentFullPath.includes('/account#/shops/chooseStore')) {\n        return 'chooseStore';\n    } else if (pathname === '/shop' && (hash.startsWith('#/') || hash === '')) {\n        return 'shop';\n    } else {\n        return 'unknown';\n    }\n}\n\n// 3. 登录页校验（保持不变）\nfunction isLoginPage() {\n    return getCurrentPageType() === 'login';\n}\n\nconsole.log(\n    '%cbuild from PakePlus： https://github.com/Sjj1024/PakePlus',\n    'color:orangered;font-weight:bolder'\n)\n\n// 全局标记（优化状态管理）\nlet currentCssKey = '';\nlet isCssLoaded = false;\nlet isLoadingCss = false;\nlet cssLinkElement = null; // 缓存CSS link元素，避免重复创建\n\n// ✅ 核心优化1：预加载CSS（页面初始化时立即启动预加载）\nfunction preloadCss(cssKey) {\n    if (!isTargetDomain()) return;\n    const targetCssUrl = PAGE_CSS_MAP[cssKey];\n    if (!targetCssUrl) return;\n\n    console.log(`预加载CSS：${targetCssUrl}`);\n    // 使用<link rel=\"preload\"提升优先级，提前加载CSS\n    const preloadLink = document.createElement('link');\n    preloadLink.rel = 'preload';\n    preloadLink.href = targetCssUrl;\n    preloadLink.as = 'style'; // 声明资源类型为样式\n    preloadLink.crossOrigin = 'anonymous';\n\n    // 预加载完成后，立即转为样式表\n    preloadLink.onload = function() {\n        preloadLink.rel = 'stylesheet';\n        console.log(`CSS预加载完成：${targetCssUrl}`);\n        // 缓存link元素，避免重复创建\n        cssLinkElement = preloadLink;\n        isCssLoaded = true;\n        isLoadingCss = false;\n    };\n\n    preloadLink.onerror = function() {\n        console.error(`CSS预加载失败：${targetCssUrl}`);\n        // 预加载失败后，降级为普通加载\n        loadCss(cssKey);\n    };\n\n    document.head.appendChild(preloadLink);\n    isLoadingCss = true;\n}\n\n// ✅ 核心优化2：优化CSS加载逻辑（复用缓存，提升优先级）\nfunction loadCss(cssKey) {\n    if (isLoadingCss || isCssLoaded ||!PAGE_CSS_MAP[cssKey]) return;\n    \n    isLoadingCss = true;\n    const targetCssUrl = PAGE_CSS_MAP[cssKey];\n    console.log(`开始加载CSS：${targetCssUrl}`);\n\n    // 复用已缓存的link元素（避免重复创建）\n    if (cssLinkElement && cssLinkElement.href === targetCssUrl) {\n        document.head.appendChild(cssLinkElement);\n        isCssLoaded = true;\n        isLoadingCss = false;\n        console.log(`复用缓存的CSS link元素`);\n        return;\n    }\n\n    // 创建新link元素（添加优先级提升属性）\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.href = targetCssUrl;\n    link.crossOrigin = 'anonymous';\n    link.media = 'all'; // 强制应用于所有设备\n    link.setAttribute('importance', 'high'); // 标记为高优先级（现代浏览器支持）\n\n    // 优化加载成功回调（立即标记状态）\n    link.onload = function() {\n        console.log(`CSS加载成功：${targetCssUrl}`);\n        currentCssKey = cssKey;\n        isCssLoaded = true;\n        isLoadingCss = false;\n        cssLinkElement = link; // 缓存元素\n    };\n\n    link.onerror = function() {\n        console.error(`CSS加载失败：${targetCssUrl}`);\n        isLoadingCss = false;\n        // 仅重试1次，避免无限循环\n        setTimeout(() => {\n            if (!isCssLoaded) loadCss(cssKey);\n        }, 1000);\n    };\n\n    // 插入到head最前面，优先加载\n    document.head.insertBefore(link, document.head.firstChild);\n}\n\n// ✅ 核心优化3：移除旧CSS（仅在页面类型变化时执行，避免频繁操作）\nfunction removeOldCustomCss() {\n    if (cssLinkElement) {\n        cssLinkElement.remove();\n        console.log(`已移除旧CSS：${cssLinkElement.href}`);\n    }\n    // 清除预加载的link元素\n    const preloadLinks = document.querySelectorAll(`link[rel=\"preload\"][href*=\"server.kexuny.cn/work/\"]`);\n    preloadLinks.forEach(link => link.remove());\n    \n    currentCssKey = '';\n    isCssLoaded = false;\n    cssLinkElement = null;\n}\n\n// ✅ 核心优化4：CSS加载控制（预加载+即时应用，避免闪动）\nfunction loadCurrentPageCss() {\n    if (!isTargetDomain()) return;\n    \n    const newPageType = getCurrentPageType();\n    \n    // 未知页面：清理CSS\n    if (newPageType === 'unknown') {\n        if (currentCssKey!== '') {\n            console.log('当前页面无对应CSS配置，清理旧样式');\n            removeOldCustomCss();\n        }\n        return;\n    }\n    \n    // 页面类型变化：清理旧CSS + 预加载新CSS\n    if (newPageType!== currentCssKey) {\n        removeOldCustomCss();\n        // 立即预加载新页面CSS\n        preloadCss(newPageType);\n        return;\n    }\n    \n    // 页面类型未变，但CSS未加载：立即加载\n    if (!isCssLoaded) {\n        loadCss(newPageType);\n    }\n}\n\n// 5. 加载外部JS（保持不变）\nfunction loadExternalScript(url) {\n    const existingScript = document.querySelector(`script[src=\"${url}\"]`);\n    if (existingScript) {\n        console.log(`备用JS已加载：${url}`);\n        if (isLoginPage()) initLoginEventOnly();\n        return;\n    }\n\n    const script = document.createElement('script');\n    script.src = url;\n    script.type = 'text/javascript';\n    script.async = false;\n    script.defer = false;\n\n    const executeWhenReady = () => {\n        if (document.readyState === 'complete' || document.readyState === 'interactive') {\n            document.head.appendChild(script);\n        } else {\n            setTimeout(executeWhenReady, 100);\n        }\n    };\n\n    script.onload = function() {\n        console.log(`备用JS加载成功：${url}`);\n        console.log('备用JS仅启用事件响应，屏蔽样式操作');\n        if (typeof window.hideElements === 'function') {\n            const originalHideElements = window.hideElements;\n            window.hideElements = function() {\n                try {\n                    console.log('屏蔽hideElements中的样式操作，仅保留事件逻辑');\n                    if (isLoginPage()) initLoginEventOnly();\n                } catch (e) {\n                    console.error('重写hideElements执行出错：', e);\n                }\n            };\n            console.log('已重写hideElements，仅保留事件功能');\n        } else {\n            if (isLoginPage()) initLoginEventOnly();\n        }\n    };\n\n    script.onerror = function() {\n        console.error(`备用JS加载失败：${url}`);\n        retryLoadJs(url, 3, 2000);\n    };\n\n    executeWhenReady();\n}\n\n// 6. JS重试加载（保持不变）\nfunction retryLoadJs(url, maxRetries, delay) {\n    let retries = 0;\n    const attemptLoad = () => {\n        retries++;\n        if (retries <= maxRetries) {\n            console.log(`备用JS第${retries}次重试加载：${url}`);\n            setTimeout(() => loadExternalScript(url), delay);\n        } else {\n            console.error(`备用JS达到最大重试次数(${maxRetries})，尝试直接初始化事件`);\n            if (isLoginPage()) initLoginEventOnly();\n        }\n    };\n    attemptLoad();\n}\n\n// 7. 登录事件初始化（保持不变）\nfunction initLoginEventOnly() {\n    if (!isLoginPage()) return;\n    console.log('开始初始化登录事件响应（无样式操作）');\n\n    const waitForLoginBtn = () => {\n        const loginBtn = document.querySelector('.style-login-botton.ivu-btn[data-v-2f9eb9a7]');\n        if (!loginBtn) {\n            console.log('未找到登录按钮，1秒后重试');\n            setTimeout(waitForLoginBtn, 1000);\n            return;\n        }\n\n        loginBtn.removeEventListener('click', handleLoginClick);\n        function handleLoginClick(e) {\n            if (loginBtn.__vue__) {\n                const vueInstance = loginBtn.__vue__;\n                const commonLoginMethods = ['handleLogin', 'submitLogin', 'onLogin', 'login'];\n                for (const method of commonLoginMethods) {\n                    if (typeof vueInstance[method] === 'function') {\n                        vueInstance[method]();\n                        console.log(`登录事件：通过Vue方法[${method}]触发`);\n                        return;\n                    }\n                }\n            }\n\n            const loginForm = loginBtn.closest('form.ivu-form');\n            if (loginForm) {\n                e.preventDefault();\n                const submitEvent = new Event('submit', { bubbles: true, cancelable: true });\n                loginForm.dispatchEvent(submitEvent);\n                console.log(`登录事件：通过表单submit触发`);\n                return;\n            }\n\n            const nativeClickEvent = new MouseEvent('click', {\n                bubbles: true,\n                cancelable: true,\n                view: window\n            });\n            loginBtn.dispatchEvent(nativeClickEvent);\n            console.log(`登录事件：通过原生点击事件触发`);\n        }\n\n        loginBtn.addEventListener('click', handleLoginClick);\n        console.log('登录事件响应初始化完成（无样式干扰）');\n    };\n\n    waitForLoginBtn();\n}\n\n// 8. Chunk加载失败处理（保持不变）\nwindow.addEventListener('error', function(e) {\n    if (!isTargetDomain()) return;\n    if (e.target.tagName === 'SCRIPT') {\n        const url = e.target.src;\n        if (url.includes('chunk')) {\n            console.error(`Chunk加载失败：${url}`);\n            retryLoadJs(url, 3, 3000);\n        }\n    }\n}, true);\n\n// 9. 点击事件处理（保持不变）\nconst hookClick = (e) => {\n    if (!isTargetDomain()) return;\n    const origin = e.target.closest('a');\n    const isBaseTargetBlank = document.querySelector('head base[target=\"_blank\"]');\n    if ((origin && origin.href && origin.target === '_blank') || (origin && origin.href && isBaseTargetBlank)) {\n        e.preventDefault();\n        console.log('处理新窗口链接：', origin.href);\n        location.href = origin.href;\n    }\n};\n\nwindow.open = function (url, target, features) {\n    if (!isTargetDomain()) return;\n    console.log('拦截window.open：', url);\n    location.href = url;\n};\n\n// ✅ 核心优化5：路由监听（提前触发预加载，减少延迟）\nfunction watchRouteChange() {\n    if (!isTargetDomain()) return;\n\n    // 监听hash变化（立即预加载）\n    window.addEventListener('hashchange', () => {\n        console.log('路由hash变化，触发CSS预加载');\n        const newPageType = getCurrentPageType();\n        if (newPageType!== currentCssKey) {\n            preloadCss(newPageType); // 优先预加载\n        }\n        setTimeout(loadCurrentPageCss, 0);\n    }, { capture: true });\n\n    // 监听Vue Router（提前预加载）\n    const checkVueRouter = () => {\n        if (window.Vue && window.VueRouter) {\n            const router = window.app?._router || window.$router || window.router;\n            if (router && router.beforeEach) {\n                // 路由守卫阶段就预加载CSS\n                router.beforeEach((to, from, next) => {\n                    console.log(`Vue Router即将切换：${from.path} → ${to.path}`);\n                    const newPageType = getCurrentPageType();\n                    if (newPageType!== currentCssKey) {\n                        preloadCss(newPageType);\n                    }\n                    next();\n                });\n                // 路由切换完成后，确保样式应用\n                router.afterEach(() => {\n                    setTimeout(loadCurrentPageCss, 0);\n                });\n                console.log('已监听Vue Router并提前预加载CSS');\n            }\n        } else {\n            setTimeout(checkVueRouter, 1000);\n        }\n    };\n    checkVueRouter();\n\n    // 监听DOM变化（优化防抖，提前触发）\n    const initMutationObserver = () => {\n        if (document.body) {\n            const observer = new MutationObserver((mutations) => {\n                clearTimeout(window.mutationDebounceTimer);\n                // 防抖时间缩短至300ms，更早触发检查\n                window.mutationDebounceTimer = setTimeout(() => {\n                    const newPageType = getCurrentPageType();\n                    if (newPageType!== currentCssKey ||!isCssLoaded) {\n                        console.log('DOM稳定后触发CSS检查');\n                        loadCurrentPageCss();\n                    }\n                }, 300);\n            });\n            observer.observe(document.body, { childList: true });\n            console.log('MutationObserver初始化成功（仅监听body直接子元素变化）');\n        } else {\n            setTimeout(initMutationObserver, 50);\n        }\n    };\n    initMutationObserver();\n\n    // ✅ 核心优化6：页面初始化时立即预加载（关键！解决首次加载延迟）\n    setTimeout(() => {\n        const newPageType = getCurrentPageType();\n        if (newPageType!== 'unknown' &&!isCssLoaded) {\n            console.log('页面初始化，立即预加载CSS');\n            preloadCss(newPageType); // 优先预加载\n            setTimeout(loadCurrentPageCss, 100); // 100ms后确保应用\n        }\n    }, 0); // 立即执行，不等待\n}\n\n// 10. 启动入口（优化初始化顺序）\nif (isTargetDomain()) {\n    currentCssKey = getCurrentPageType();\n    window.lastPageFullPath = window.location.pathname + window.location.hash;\n    window.mutationDebounceTimer = null;\n    \n    // 先启动路由监听和预加载，再加载CSS\n    watchRouteChange();\n}","isHtml":false,"htmlPath":"","htmlFiles":[],"prefix":"","pcRepo":"PakePlus-v2.1.3","iosRepo":"PakePlus-iOS-v2.1.3","androidRepo":"PakePlus-Android-v2.1.3","more":{"windows":{"label":"","title":"门店助手","url":"https://account.fuhaogou.com","userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36","width":800,"height":600,"theme":null,"resizable":true,"fullscreen":false,"maximized":false,"minWidth":400,"minHeight":300,"maxWidth":1920,"maxHeight":1080,"decorations":true,"transparent":false,"titleBarStyle":"Visible","visible":true,"focus":true,"closable":true,"minimizable":true,"maximizable":true,"alwaysOnTop":false,"alwaysOnBottom":false,"center":false,"shadow":true,"skipTaskbar":false,"tabbingIdentifier":null,"parent":null,"dragDropEnabled":true,"browserExtensionsEnabled":false,"devtools":true,"contentProtected":false,"hiddenTitle":false,"incognito":false,"proxyUrl":null,"useHttpsScheme":false,"zoomHotkeysEnabled":false,"acceptFirstMouse":false,"create":false,"backgroundColor":null,"backgroundThrottling":null,"javascriptDisabled":false}},"phone":{"safeArea":{"top":0,"bottom":0,"left":0,"right":0},"header":{"show":false,"title":"","backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","loading":false,"toolBar":false,"toolBarBackgroundColor":"","toolBarColor":"","toolBarFontSize":16,"toolBarFontWeight":"bold"},"siderMenu":{"show":false,"width":0,"backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","title":"","titleColor":"","titleFontSize":16,"titleFontWeight":"bold"},"tabBar":{"show":false,"backgroundColor":"","color":"","activeColor":"","fontSize":16,"fontWeight":"bold","tabBarItem":[]},"webview":{"userAgent":"","javaScriptEnabled":true,"domStorageEnabled":true,"allowFileAccess":true,"loadWithOverviewMode":true,"setSupportZoom":true,"clearCache":true}},"ios":{"name":"dacfabbeab","showName":"门店助手","version":"1.0.1","webUrl":"https://account.fuhaogou.com","id":"youtuan.app.ios","icon":"./app-icon.png","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":true,"safeArea":"all"},"android":{"name":"dacfabbeab","showName":"门店助手","version":"1.0.1","webUrl":"https://account.fuhaogou.com","id":"youtuan.app.android","icon":"./app-icon.png","input":"./app-icon.png","output":"./res","rounded":true,"copyTo":"./app/src/main/res","androidResDir":"./app/src/main/res","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":true,"safeArea":"all"},"desktop":{"name":"dacfabbeab","showName":"门店助手","version":"1.0.1","id":"youtuan.app.desktop","desc":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","webUrl":"https://account.fuhaogou.com","iconPath":"../app-icon.png","inputPath":"../app-icon.png","tempPath":"./processed-image.png","icnsPath":"../src-tauri/icons/icon.icns","pubBody":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","isHtml":false,"single":true,"state":true,"injectJq":false,"tauriApi":false,"buildMethod":"local","debug":false}}