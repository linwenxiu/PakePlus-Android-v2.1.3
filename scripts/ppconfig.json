{"name":"dacfabbeab","url":"https://account.fuhaogou.com","showName":"门店助手","appid":"youtuan.app","icon":"","iconPath":"","iconRound":true,"state":true,"single":true,"injectJq":true,"tauriApi":false,"devbug":true,"version":"1.0.1","preview":"desktop","platform":["1-1"],"width":800,"height":600,"desc":"","jsFile":[],"filterCss":"","customJs":"// 全局配置：目标域名、页面路径及对应CSS映射（便于维护）\nconst TARGET_DOMAIN = 'fuhaogou.com';\nconst LOGIN_PAGE_PATH = '/account#/login';\n// 页面路径匹配规则 + 对应CSS文件（key：路径标识，value：CSS链接）\nconst PAGE_CSS_MAP = {\n    login: 'https://server.kexuny.cn/work/midd.css', // 登录页\n    chooseStore: 'https://server.kexuny.cn/work/mdxz.css', // 门店选择页\n    shop: 'https://server.kexuny.cn/work/shop.css' // shop及子页面\n};\n\n// 1. 域名校验：仅在目标域名下执行所有逻辑\nfunction isTargetDomain() {\n    const currentDomain = window.location.hostname;\n    const isMatch = currentDomain.includes(TARGET_DOMAIN);\n    if (!isMatch) {\n        console.log(`当前域名${currentDomain}非目标域名，停止执行脚本`);\n    }\n    return isMatch;\n}\n\n// 2. 页面类型判断：根据当前路径匹配对应页面类型（用于加载CSS）\nfunction getCurrentPageType() {\n    const currentFullPath = window.location.pathname + window.location.hash;\n    console.log(`当前页面路径：${currentFullPath}`);\n    \n    // 匹配规则：按路径优先级排序（精准匹配在前，模糊匹配在后）\n    if (currentFullPath === LOGIN_PAGE_PATH) {\n        return 'login'; // 登录页（精准匹配）\n    } else if (currentFullPath.includes('/account#/shops/chooseStore')) {\n        return 'chooseStore'; // 门店选择页（模糊匹配路径标识）\n    } else if (currentFullPath.includes('/shop#/')) {\n        return 'shop'; // shop及子页面（模糊匹配路径前缀）\n    } else {\n        return 'unknown'; // 未知页面（不加载额外CSS）\n    }\n}\n\n// 3. 登录页校验：仅在登录页执行登录事件初始化\nfunction isLoginPage() {\n    return getCurrentPageType() === 'login';\n}\n\nconsole.log(\n    '%cbuild from PakePlus： https://github.com/Sjj1024/PakePlus',\n    'color:orangered;font-weight:bolder'\n)\n\n// 全局标记：当前加载的CSS文件（避免重复加载）\nlet currentLoadedCssUrl = '';\n// 全局标记：CSS是否加载成功\nlet isCssLoadedSuccess = false;\n\n// 4. 移除所有已加载的自定义CSS（切换页面时清理旧样式）\nfunction removeOldCustomCss() {\n    const customCssLinks = document.querySelectorAll(`link[href*=\"server.kexuny.cn/work/\"]`);\n    customCssLinks.forEach(link => {\n        link.remove();\n        console.log(`已移除旧CSS：${link.href}`);\n    });\n    currentLoadedCssUrl = '';\n    isCssLoadedSuccess = false;\n}\n\n// 5. 加载当前页面对应的CSS（核心函数）\nfunction loadCurrentPageCss() {\n    if (!isTargetDomain()) return;\n    \n    const pageType = getCurrentPageType();\n    const targetCssUrl = PAGE_CSS_MAP[pageType];\n    \n    // 未知页面：不加载CSS\n    if (pageType === 'unknown') {\n        console.log('当前页面无对应CSS配置，不加载额外样式');\n        removeOldCustomCss(); // 清理旧CSS\n        return;\n    }\n    \n    // 已加载目标CSS：无需重复加载\n    if (currentLoadedCssUrl === targetCssUrl) {\n        console.log(`当前页面CSS已加载：${targetCssUrl}`);\n        // 登录页需初始化登录事件\n        if (isLoginPage()) initLoginEventOnly();\n        return;\n    }\n    \n    // 移除旧CSS，加载新CSS\n    removeOldCustomCss();\n    const link = document.createElement('link');\n    link.href = targetCssUrl;\n    link.rel = 'stylesheet';\n    link.type = 'text/css';\n    \n    // 确保DOM准备好后加载CSS\n    const loadWhenReady = () => {\n        if (document.readyState === 'complete' || document.readyState === 'interactive') {\n            document.head.appendChild(link);\n        } else {\n            setTimeout(loadWhenReady, 100);\n        }\n    };\n    \n    // CSS加载成功\n    link.onload = function() {\n        console.log(`当前页面CSS加载成功：${targetCssUrl}`);\n        currentLoadedCssUrl = targetCssUrl;\n        isCssLoadedSuccess = true;\n        // 仅登录页初始化登录事件\n        if (isLoginPage()) initLoginEventOnly();\n    };\n    \n    // CSS加载失败：重试5次后提示\n    link.onerror = function() {\n        console.error(`当前页面CSS加载失败：${targetCssUrl}`);\n        retryLoadCss(targetCssUrl, 5, 2000);\n    };\n    \n    loadWhenReady();\n}\n\n// 6. CSS重试加载函数\nfunction retryLoadCss(cssUrl, maxRetries, delay) {\n    let retries = 0;\n    const attemptLoad = () => {\n        retries++;\n        if (retries <= maxRetries) {\n            console.log(`CSS第${retries}次重试加载：${cssUrl}`);\n            const link = document.createElement('link');\n            link.href = cssUrl;\n            link.rel = 'stylesheet';\n            link.type = 'text/css';\n            link.onload = function() {\n                console.log(`CSS重试加载成功：${cssUrl}`);\n                currentLoadedCssUrl = cssUrl;\n                isCssLoadedSuccess = true;\n                if (isLoginPage()) initLoginEventOnly();\n            };\n            link.onerror = attemptLoad; // 失败继续重试\n            document.head.appendChild(link);\n        } else {\n            console.error(`CSS达到最大重试次数(${maxRetries})，加载失败`);\n        }\n    };\n    attemptLoad();\n}\n\n// 7. 加载外部JS的函数（仅登录页CSS失败时使用，保持原有逻辑）\nfunction loadExternalScript(url) {\n    const existingScript = document.querySelector(`script[src=\"${url}\"]`);\n    if (existingScript) {\n        console.log(`备用JS已加载：${url}`);\n        if (isLoginPage()) initLoginEventOnly();\n        return;\n    }\n\n    const script = document.createElement('script');\n    script.src = url;\n    script.type = 'text/javascript';\n    script.async = false;\n    script.defer = false;\n\n    const executeWhenReady = () => {\n        if (document.readyState === 'complete' || document.readyState === 'interactive') {\n            document.head.appendChild(script);\n        } else {\n            setTimeout(executeWhenReady, 100);\n        }\n    };\n\n    script.onload = function() {\n        console.log(`备用JS加载成功：${url}`);\n        console.log('备用JS仅启用事件响应，屏蔽样式操作');\n        if (typeof window.hideElements === 'function') {\n            const originalHideElements = window.hideElements;\n            window.hideElements = function() {\n                try {\n                    console.log('屏蔽hideElements中的样式操作，仅保留事件逻辑');\n                    if (isLoginPage()) initLoginEventOnly();\n                } catch (e) {\n                    console.error('重写hideElements执行出错：', e);\n                }\n            };\n            console.log('已重写hideElements，仅保留事件功能');\n        } else {\n            if (isLoginPage()) initLoginEventOnly();\n        }\n    };\n\n    script.onerror = function() {\n        console.error(`备用JS加载失败：${url}`);\n        retryLoadJs(url, 3, 2000);\n    };\n\n    executeWhenReady();\n}\n\n// 8. JS重试加载函数\nfunction retryLoadJs(url, maxRetries, delay) {\n    let retries = 0;\n    const attemptLoad = () => {\n        retries++;\n        if (retries <= maxRetries) {\n            console.log(`备用JS第${retries}次重试加载：${url}`);\n            setTimeout(() => loadExternalScript(url), delay);\n        } else {\n            console.error(`备用JS达到最大重试次数(${maxRetries})，尝试直接初始化事件`);\n            if (isLoginPage()) initLoginEventOnly();\n        }\n    };\n    attemptLoad();\n}\n\n// 9. 登录事件初始化（保持原有逻辑不变）\nfunction initLoginEventOnly() {\n    if (!isLoginPage()) return;\n    console.log('开始初始化登录事件响应（无样式操作）');\n\n    const waitForLoginBtn = () => {\n        const loginBtn = document.querySelector('.style-login-botton.ivu-btn[data-v-2f9eb9a7]');\n        if (!loginBtn) {\n            console.log('未找到登录按钮，1秒后重试');\n            setTimeout(waitForLoginBtn, 1000);\n            return;\n        }\n\n        loginBtn.removeEventListener('click', handleLoginClick);\n        function handleLoginClick(e) {\n            // 场景1：Vue框架\n            if (loginBtn.__vue__) {\n                const vueInstance = loginBtn.__vue__;\n                const commonLoginMethods = ['handleLogin', 'submitLogin', 'onLogin', 'login'];\n                for (const method of commonLoginMethods) {\n                    if (typeof vueInstance[method] === 'function') {\n                        vueInstance[method]();\n                        console.log(`登录事件：通过Vue方法[${method}]触发`);\n                        return;\n                    }\n                }\n            }\n\n            // 场景2：原生表单\n            const loginForm = loginBtn.closest('form.ivu-form');\n            if (loginForm) {\n                e.preventDefault();\n                const submitEvent = new Event('submit', { bubbles: true, cancelable: true });\n                loginForm.dispatchEvent(submitEvent);\n                console.log(`登录事件：通过表单submit触发`);\n                return;\n            }\n\n            // 场景3：原生点击\n            const nativeClickEvent = new MouseEvent('click', {\n                bubbles: true,\n                cancelable: true,\n                view: window\n            });\n            loginBtn.dispatchEvent(nativeClickEvent);\n            console.log(`登录事件：通过原生点击事件触发`);\n        }\n\n        loginBtn.addEventListener('click', handleLoginClick);\n        console.log('登录事件响应初始化完成（无样式干扰）');\n    };\n\n    waitForLoginBtn();\n}\n\n// 10. 原有chunk加载失败处理（保持不变）\nwindow.addEventListener('error', function(e) {\n    if (!isTargetDomain()) return;\n    if (e.target.tagName === 'SCRIPT') {\n        const url = e.target.src;\n        if (url.includes('chunk')) {\n            console.error(`Chunk加载失败：${url}`);\n            retryLoadJs(url, 3, 3000);\n        }\n    }\n}, true);\n\n// 11. 原有核心点击事件处理（保持不变）\nconst hookClick = (e) => {\n    if (!isTargetDomain()) return;\n    const origin = e.target.closest('a');\n    const isBaseTargetBlank = document.querySelector('head base[target=\"_blank\"]');\n    if ((origin && origin.href && origin.target === '_blank') || (origin && origin.href && isBaseTargetBlank)) {\n        e.preventDefault();\n        console.log('处理新窗口链接：', origin.href);\n        location.href = origin.href;\n    }\n};\n\nwindow.open = function (url, target, features) {\n    if (!isTargetDomain()) return;\n    console.log('拦截window.open：', url);\n    location.href = url;\n};\n\ndocument.addEventListener('click', hookClick, { capture: true });\n\n// 12. 监听Vue SPA路由变化（核心：切换页面时自动加载对应CSS）\nfunction watchRouteChange() {\n    if (!isTargetDomain()) return;\n\n    // 方式1：监听hash变化（适配Vue hash路由，最通用）\n    window.addEventListener('hashchange', () => {\n        console.log('路由hash变化，重新加载CSS');\n        loadCurrentPageCss();\n    });\n\n    // 方式2：监听Vue Router实例（如果页面使用Vue Router）\n    const checkVueRouter = () => {\n        if (window.Vue && window.VueRouter) {\n            const router = window.app?._router || window.$router || window.router;\n            if (router && router.afterEach) {\n                router.afterEach((to, from) => {\n                    console.log(`Vue Router切换：${from.path} → ${to.path}`);\n                    loadCurrentPageCss();\n                });\n                console.log('已监听Vue Router变化');\n            }\n        } else {\n            // 未找到Vue Router，1秒后重试（避免加载时机过早）\n            setTimeout(checkVueRouter, 1000);\n        }\n    };\n    checkVueRouter();\n}\n\n// 13. 启动入口：初始化加载+监听路由变化\nif (isTargetDomain()) {\n    // 页面初始加载时加载对应CSS\n    loadCurrentPageCss();\n    // 监听路由变化，动态切换CSS\n    watchRouteChange();\n}","isHtml":false,"htmlPath":"","htmlFiles":[],"prefix":"","pcRepo":"PakePlus-v2.1.3","iosRepo":"PakePlus-iOS-v2.1.3","androidRepo":"PakePlus-Android-v2.1.3","more":{"windows":{"label":"","title":"门店助手","url":"https://account.fuhaogou.com","userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36","width":800,"height":600,"theme":null,"resizable":true,"fullscreen":false,"maximized":false,"minWidth":400,"minHeight":300,"maxWidth":1920,"maxHeight":1080,"decorations":true,"transparent":false,"titleBarStyle":"Visible","visible":true,"focus":true,"closable":true,"minimizable":true,"maximizable":true,"alwaysOnTop":false,"alwaysOnBottom":false,"center":false,"shadow":true,"skipTaskbar":false,"tabbingIdentifier":null,"parent":null,"dragDropEnabled":true,"browserExtensionsEnabled":false,"devtools":true,"contentProtected":false,"hiddenTitle":false,"incognito":false,"proxyUrl":null,"useHttpsScheme":false,"zoomHotkeysEnabled":false,"acceptFirstMouse":false,"create":false,"backgroundColor":null,"backgroundThrottling":null,"javascriptDisabled":false}},"phone":{"safeArea":{"top":0,"bottom":0,"left":0,"right":0},"header":{"show":false,"title":"","backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","loading":false,"toolBar":false,"toolBarBackgroundColor":"","toolBarColor":"","toolBarFontSize":16,"toolBarFontWeight":"bold"},"siderMenu":{"show":false,"width":0,"backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","title":"","titleColor":"","titleFontSize":16,"titleFontWeight":"bold"},"tabBar":{"show":false,"backgroundColor":"","color":"","activeColor":"","fontSize":16,"fontWeight":"bold","tabBarItem":[]},"webview":{"userAgent":"","javaScriptEnabled":true,"domStorageEnabled":true,"allowFileAccess":true,"loadWithOverviewMode":true,"setSupportZoom":true,"clearCache":true}},"ios":{"name":"dacfabbeab","showName":"门店助手","version":"1.0.1","webUrl":"https://account.fuhaogou.com","id":"youtuan.app.ios","icon":"./app-icon.png","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":true,"safeArea":"all"},"android":{"name":"dacfabbeab","showName":"门店助手","version":"1.0.1","webUrl":"https://account.fuhaogou.com","id":"youtuan.app.android","icon":"./app-icon.png","input":"./app-icon.png","output":"./res","rounded":true,"copyTo":"./app/src/main/res","androidResDir":"./app/src/main/res","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":true,"safeArea":"all"},"desktop":{"name":"dacfabbeab","showName":"门店助手","version":"1.0.1","id":"youtuan.app.desktop","desc":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","webUrl":"https://account.fuhaogou.com","iconPath":"../app-icon.png","inputPath":"../app-icon.png","tempPath":"./processed-image.png","icnsPath":"../src-tauri/icons/icon.icns","pubBody":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","isHtml":false,"single":true,"state":true,"injectJq":false,"tauriApi":false,"buildMethod":"local","debug":false}}